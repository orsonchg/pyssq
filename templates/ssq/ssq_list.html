{% extends 'base.html' %}

{% block title %}双色球列表{% endblock %}

{% block css %}
    <style>
        /* 自定义样式增强 */
        .card {
            transition: all 0.2s ease-in-out;
        }

        .card:hover {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }

        .badge-red-ball {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background-color: #dc3545;
            color: white;
            text-align: center;
            margin: 0 2px;
            font-weight: 600;
        }

        .badge-blue-ball {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background-color: #0d6efd;
            color: white;
            text-align: center;
            margin: 0 2px;
            font-weight: 600;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .loading-spinner {
            display: none;
            width: 3rem;
            height: 3rem;
        }

        .empty-state {
            padding: 3rem 1rem;
        }

        /* 响应式优化 */
        @media (max-width: 768px) {
            .btn-group {
                flex-wrap: wrap;
            }

            .btn-group .btn {
                flex: 1 0 auto;
                margin-bottom: 0.5rem;
            }

            .card-body {
                padding: 1rem;
            }
        }

        /* 统计卡片样式增强 */
        .stat-card {
            border-radius: 0.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }

        .stat-card .card-body {
            padding: 1.25rem;
        }

        /* 按钮样式统一 */
        .btn-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon i {
            margin-right: 0.5rem;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <!-- 页面标题 -->
                <div class="mb-4">
                    <h2 class="h3 mb-0 fw-bold text-dark">
                        <i class="bi bi-bar-chart-fill text-primary me-2"></i>双色球开奖记录
                    </h2>
                    <p class="text-muted mt-1">查看和管理双色球历史开奖记录</p>
                </div>

                <!-- 控制面板卡片 -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="mb-0 fw-medium">
                            <i class="bi bi-sliders me-2"></i>数据控制面板
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3 align-items-end">
                            <!-- 新增按钮 -->
                            <div class="col-md-2 col-sm-6">
                                <a href="{% url 'ssq:ssq_create' %}" class="btn btn-success w-100 btn-icon"> <i class="fas fa-plus-circle"></i>新增记录 </a>
                            </div>

                            <!-- 搜索框 -->
                            <div class="col-md-3 col-sm-6">
                                <label for="search-input" class="form-label mb-1">
                                    <i class="bi bi-search me-1"></i>期号/日期搜索
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control form-control-lg" id="search-input"
                                           placeholder="输入期号或开奖日期..." aria-label="搜索">
                                    <span class="input-group-text bg-light">
                                    <i class="bi bi-calendar-alt"></i>
                                </span>
                                </div>
                            </div>

                            <!-- 蓝球过滤 -->
                            <div class="col-md-2 col-sm-6">
                                <label for="blue-ball-filter" class="form-label mb-1">
                                    <i class="bi bi-basketball-ball me-1 text-primary"></i>蓝球过滤
                                </label>
                                <select class="form-select form-select-lg" id="blue-ball-filter" aria-label="选择蓝球">
                                    <option value="">全部蓝球</option>
                                    {% for num in "x"|ljust:"16" %}
                                        <option value="{{ forloop.counter }}" class="text-primary">
                                            {{ forloop.counter }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- 排序选择 -->
                            <div class="col-md-2 col-sm-6">
                                <label for="sort-select" class="form-label mb-1">
                                    <i class="bi bi-sort-down-alt me-1"></i>排序方式
                                </label>
                                <select class="form-select form-select-lg" id="sort-select" aria-label="排序方式">
                                    <option value="-period">期号（降序）</option>
                                    <option value="period">期号（升序）</option>
                                    <option value="-draw_date">开奖日期（降序）</option>
                                    <option value="draw_date">开奖日期（升序）</option>
                                    <option value="-red_sum">红球和值（降序）</option>
                                    <option value="red_sum">红球和值（升序）</option>
                                </select>
                            </div>

                            <!-- 操作按钮 -->
                            <div class="col-md-3 col-sm-12">
                                <label class="form-label mb-1 invisible">操作</label>
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-primary btn-icon" id="search-btn">
                                        <i class="bi bi-search"></i>搜索
                                    </button>
                                    <button class="btn btn-outline-secondary btn-icon" id="reset-btn">
                                        <i class="bi bi-arrow-counterclockwise"></i>重置
                                    </button>
                                    <!-- 查看最新一期按钮 -->
                                    <a href="#" class="btn btn-success btn-icon" id="latest-btn">
                                        <i class="bi bi-star"></i>最新一期
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 记录列表 -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="mb-0 fw-medium">
                            <i class="bi bi-table me-2"></i>开奖记录列表
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">

                            <table class="table table-hover table-bordered mb-0" id="ssq-table">
                                <thead class="table-light">
                                <tr>
                                    <th class="text-center" style="width: 8%">期号</th>
                                    <th class="text-center" style="width: 12%">开奖日期</th>
                                    <th class="text-center" style="width: 18%">红球</th>
                                    <th class="text-center" style="width: 8%">蓝球</th>
                                    <th class="text-center" style="width: 8%">奇:偶</th>
                                    <th class="text-center" style="width: 5%">质数</th>
                                    <th class="text-center" style="width: 5%">和值</th>
                                    <th class="text-center" style="width: 5%">跨度</th>
                                    <th class="text-center" style="width: 5%">尾和</th>
                                    <th class="text-center">三区分布</th>
                                    <th class="text-center" style="width: 18%">操作</th>
                                </tr>
                                </thead>
                                <tbody id="ssq-tbody">
                                {% if ssq_objs %}
                                    {% for item in ssq_objs %}
                                        <tr>
                                            <td class="text-center align-middle">{{ item.period }}</td>
                                            <td class="text-center align-middle">
                                                <i class="fas fa-calendar-alt mr-2 text-muted"></i>
                                                {{ item.draw_date|date:"Y-m-d" }}
                                            </td>
                                            <td class="text-center align-middle">
                                                <div class="d-flex justify-content-center flex-wrap">
                                                    {% for num in item.red_balls %}
                                                        <p class="badge-red-ball"> {{ num }} </p>
                                                    {% endfor %}
                                                </div>
                                            </td>
                                            <td class="text-center align-middle">
                                                <p class="badge-blue-ball">{{ item.blue_ball }}</p>
                                            </td>
                                            <td class="text-center align-middle">
                                                {% if item.red_odd_count == 1 %}
                                                    <span class="badge text-bg-primary px-3 py-1 fs-6">{{ item.red_odd_count }}:{{ item.red_even_count }}</span>
                                                {% elif item.red_odd_count == 2 %}
                                                    <span class="badge text-bg-dark px-3 py-1 fs-6">{{ item.red_odd_count }}:{{ item.red_even_count }}</span>
                                                {% elif item.red_odd_count == 3 %}
                                                    <span class="badge text-bg-success px-3 py-1 fs-6">{{ item.red_odd_count }}:{{ item.red_even_count }}</span>
                                                {% elif item.red_odd_count == 4 %}
                                                    <span class="badge text-bg-danger px-3 py-1 fs-6">{{ item.red_odd_count }}:{{ item.red_even_count }}</span>
                                                {% elif item.red_odd_count == 5 %}
                                                    <span class="badge text-bg-warning px-3 py-1 fs-6">{{ item.red_odd_count }}:{{ item.red_even_count }}</span>
                                                {% elif item.red_odd_count == 6 %}
                                                    <span class="badge text-bg-info px-3 py-1 fs-6">{{ item.red_odd_count }}:{{ item.red_even_count }}</span>
                                                {% else %}
                                                    <span class="badge text-bg-secondary px-3 py-1 fs-6">{{ item.red_odd_count }}:{{ item.red_even_count }}</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-center align-middle">
                                                {{ item.red_prime_count }}
                                            </td>
                                            <td class="text-center align-middle">
                                                {{ item.red_sum }}
                                            </td>
                                            <td class="text-center align-middle">
                                                {{ item.red_span }}
                                            </td>
                                            <td class="text-center align-middle">
                                                {{ item.red_tail_sum }}
                                            </td>

                                            <td class="text-center align-middle">
                                                {{ item.red_zones }}
                                            </td>
                                            <td class="text-center align-middle">
                                                <div class="btn-group" role="group">
                                                    <a class="btn btn-sm btn-info btn-sm btn-action" href="#">
                                                        <i class="fas fa-list mr-1"></i>详情
                                                    </a>
                                                    <a class="btn btn-sm btn-outline-primary" href="{% url 'ssq:ssq_update' item.id %}">
                                                        <i class="fas fa-edit mr-1"></i>编辑
                                                    </a>
                                                    <button class="btn btn-sm btn-outline-danger delete-btn btn-action"
                                                            data-period="${record.period}">
                                                        <i class="fas fa-trash-alt mr-1"></i>删除
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center empty-state">
                                            <div class="d-flex flex-column align-items-center justify-content-center">
                                                <i class="bi bi-inbox fa-3x text-muted mb-3"></i>
                                                <p class="text-muted mb-3">暂无数据</p>
                                                <button class="btn btn-primary btn-icon mt-2" data-bs-toggle="modal" data-bs-target="#createModal">
                                                    <i class="bi bi-plus-circle"></i>添加第一条记录
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                {% endif %}
                                </tbody>
                            </table>

                        </div>
                    </div>
                    <div class="card-footer bg-white border-top py-3 d-flex justify-content-between align-items-center">
                        <!-- 分页导航 -->
                        <div>
                            {{ pager|safe }}
                        </div>
                        <!-- 加载状态 -->
                        <div class="d-none" id="loading-container">
                            <div class="spinner-border text-primary loading-spinner" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
{% endblock %}